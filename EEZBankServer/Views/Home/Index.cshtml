@{
    ViewData["Title"] = "Ana Sayfa";
}

@model EEZBankServer.Models.HesapOzetiViewModel

<link rel="stylesheet" href="~/css/Home/index.css" />

<div class="home-wrapper">
    <div class="container pb-5">

        <div class="row section-gap">
            <div class="col-12">
                @if (!User.Identity.IsAuthenticated)
                {
                    /* --- DURUM 1: MİSAFİR KULLANICI --- */
                    <div class="hero-premium">
                        <div class="hero-premium-content">
                            <span class="badge bg-warning text-dark mb-3 px-3 py-2 rounded-pill fw-bold">
                                <i class="fas fa-star me-1"></i> Yılın Parlayan Dijital Bankası
                            </span>
                            <h1 class="hero-title">Geleceğin Bankacılığı <br /> Bugün Cebinizde.</h1>
                            <p class="hero-desc">
                                EEZ Bank ile finansal özgürlüğün tadını çıkarın. Şube yok, sıra yok, masraf yok.
                                Sadece hız ve güven var.
                            </p>

                            <div class="d-flex gap-3 flex-wrap">
                                <a asp-controller="Account" asp-action="Register" class="btn btn-light text-primary btn-lg px-5 shadow-sm fw-bold">
                                    Hemen Müşteri Ol <i class="fas fa-arrow-right ms-2"></i>
                                </a>
                                <a asp-controller="Home" asp-action="Hizmetler" class="btn btn-outline-light btn-lg px-4">
                                    Keşfet
                                </a>
                            </div>

                            <div class="trust-badges">
                                <div class="badge-item"><i class="fas fa-shield-alt"></i> Uçtan Uca Güvenlik</div>
                                <div class="badge-item"><i class="fas fa-user-clock"></i> 7/24 Canlı Destek</div>
                                <div class="badge-item"><i class="fas fa-globe"></i> Global İşlemler</div>
                            </div>
                        </div>
                    </div>
                }
                else
                {
                    @if (Model.Hesaplar == null || Model.Hesaplar.Count == 0)
                    {
                        <div class="hero-premium">
                            <div class="hero-premium-content">
                                <span class="badge bg-warning text-dark mb-3 px-3 py-2 rounded-pill fw-bold">
                                    <i class="fas fa-bolt me-1"></i> 3 Dakikada Hesabın Hazır
                                </span>

                                <h1 class="hero-title">
                                    Sıfır Masraf, <br />
                                    Sınırsız Özgürlük.
                                </h1>

                                <p class="hero-desc">
                                    EFT/Havale ücretlerine ve hesap işletim masraflarına veda edin.
                                    EEZ Bank ile paranızı 7/24 ücretsiz yönetin.
                                </p>

                                <div class="d-flex gap-3 flex-wrap">
                                    <a asp-controller="Account" asp-action="HesapOlustur" class="btn btn-light text-primary btn-lg px-5 shadow-sm fw-bold">
                                        Ücretsiz Hesap Aç <i class="fas fa-arrow-right ms-2"></i>
                                    </a>
                                </div>

                                <div class="trust-badges">
                                    <div class="badge-item"><i class="fas fa-check-circle"></i> Ömür Boyu Aidatsız</div>
                                    <div class="badge-item"><i class="fas fa-shield-alt"></i> %100 Güvenli Altyapı</div>
                                    <div class="badge-item"><i class="fas fa-mobile-alt"></i> Tamamen Dijital</div>
                                </div>
                            </div>
                        </div>
                    }
                    else
                    {
                        var anaHesap = Model.Hesaplar.FirstOrDefault();
                        var toplamBakiye = Model.ToplamBakiye;
                        var kullaniciAdi = User.Identity.Name;

                        <div class="dashboard-hero">
                            <div class="user-welcome d-flex flex-column justify-content-between">
                                <div>
                                    <h2>Merhaba, @kullaniciAdi</h2>
                                    <p class="mb-1">Finansal durumun harika görünüyor!</p>
                                    <span class="text-muted small">
                                        <i class="far fa-clock me-1"></i> Son giriş: @DateTime.Now.ToString("dd.MM.yyyy HH:mm")
                                    </span>
                                </div>

                                <div class="mini-transactions mt-4">
                                    <label class="text-muted fw-bold small mb-2" style="font-size: 0.75rem; letter-spacing: 0.5px;">SON İŞLEMLER</label>

                                    @if (Model.Islemler != null && Model.Islemler.Any())
                                    {
                                        <div class="d-flex flex-column gap-2">
                                            @foreach (var islem in Model.Islemler.Take(4)) 
                                            {
                                                <div class="d-flex align-items-center justify-content-between bg-light rounded px-3 py-2 border border-light">
                                                    <div class="d-flex align-items-center gap-2">
                                                        <div class="icon-circle small bg-white shadow-sm text-center rounded-circle" style="width: 24px; height: 24px; line-height: 24px;">
                                                            <i class="fas fa-exchange-alt text-primary" style="font-size: 0.7rem;"></i>
                                                        </div>
                                                    </div>
                                                    <span class="fw-bold small">@islem.Tutar.ToString("N2") ₺</span>
                                                </div>
                                            }
                                        </div>
                                    }
                                    else
                                    {
                                        <div class="alert alert-light py-2 small text-muted border border-light">
                                            <i class="fas fa-info-circle me-1"></i> Henüz işlem geçmişiniz yok.
                                        </div>
                                    }
                                </div>
                            </div>

                            <div class="account-summary-card">
                                <span class="balance-label">Toplam Varlıklarım</span>

                                <div class="balance-amount">
                                    <span id="totalBalance"
                                          data-visible="true"
                                          data-value="₺ @toplamBakiye.ToString("N2")">
                                        ₺ @toplamBakiye.ToString("N2")
                                    </span>

                                    <span class="balance-label">@anaHesap.AccountName</span>
                                    
                                    <button class="btn btn-sm btn-link text-white p-0 ms-2" onclick="toggleBalance(this)" title="Gizle/Göster">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                </div>

                                @if (anaHesap != null)
                                {
                                    <div class="account-iban mt-3" onclick="copyIban('@anaHesap.Iban')">
                                        <span>@anaHesap.Iban</span>
                                        <i class="far fa-copy ms-auto"></i>
                                    </div>
                                }
                            </div>
                        </div>
                    }
                }
            </div>
        </div>

        <div class="row section-gap g-4">
            <div class="col-lg-8">
                <div class="row g-4 h-100">
                    <div class="col-md-4">
                        <div class="nav-action-card">
                            <div class="icon-box bg-soft-blue"><i class="fas fa-paper-plane"></i></div>
                            <h5>Hızlı Transfer</h5>
                            <p>IBAN'a veya Kolas Adres'e 7/24 anında para gönderin.</p>
                            <a href="#" class="stretched-link"></a>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="nav-action-card">
                            <div class="icon-box bg-soft-purple"><i class="fas fa-mobile-alt"></i></div>
                            <h5>Dijital Bankacılık</h5>
                            <p>Fatura ödemeden yatırım işlemlerine kadar her şey cebinizde.</p>
                            @if (!User.Identity.IsAuthenticated)
                            {
                                <a asp-controller="Account" asp-action="Register" class="stretched-link"></a>
                            }
                            else
                            {
                                <a asp-controller="Account" asp-action="Profile" class="stretched-link"></a>
                            }
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="nav-action-card">
                            <div class="icon-box bg-soft-orange"><i class="fas fa-user-plus"></i></div>
                            <h5>Hesap Aç</h5>
                            <p>Şubeye gitmeden, birkaç tıkla anında EEZ'li olun.</p>
                            <a asp-controller="Account" asp-action="HesapOlustur" class="stretched-link"></a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="sticky-widget">
                    @await Component.InvokeAsync("DovizKurlari")
                </div>
            </div>
        </div>

    </div>
</div>