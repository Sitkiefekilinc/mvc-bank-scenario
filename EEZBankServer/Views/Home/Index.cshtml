@using EEZBankServer.Models.ViewModel
@{
    ViewData["Title"] = "Ana Sayfa";
}

@model TransferIndexViewModel

<link rel="stylesheet" href="~/css/Home/index.css" />
<link rel="stylesheet" href="~/css/Transfer/index.css" />

<div class="home-wrapper">
    <div class="container pb-5">

        <div class="row section-gap">
            <div class="col-12">
                @if (!User.Identity.IsAuthenticated)
                {
                    <div class="hero-premium">
                        <div class="hero-premium-content">
                            <span class="badge bg-warning text-dark mb-3 px-3 py-2 rounded-pill fw-bold">
                                <i class="fas fa-star me-1"></i> Yılın Parlayan Dijital Bankası
                            </span>
                            <h1 class="hero-title">Geleceğin Bankacılığı <br /> Bugün Cebinizde.</h1>
                            <p class="hero-desc">
                                EEZ Bank ile finansal özgürlüğün tadını çıkarın. Şube yok, sıra yok, masraf yok.
                                Sadece hız ve güven var.
                            </p>

                            <div class="d-flex gap-3 flex-wrap">
                                <a asp-controller="Account" asp-action="Register" class="btn btn-light text-primary btn-lg px-5 shadow-sm fw-bold">
                                    Hemen Müşteri Ol <i class="fas fa-arrow-right ms-2"></i>
                                </a>
                                <a asp-controller="Home" asp-action="Hizmetler" class="btn btn-outline-light btn-lg px-4">
                                    Keşfet
                                </a>
                            </div>

                            <div class="trust-badges">
                                <div class="badge-item"><i class="fas fa-shield-alt"></i> Uçtan Uca Güvenlik</div>
                                <div class="badge-item"><i class="fas fa-user-clock"></i> 7/24 Canlı Destek</div>
                                <div class="badge-item"><i class="fas fa-globe"></i> Global İşlemler</div>
                            </div>
                        </div>
                    </div>
                }
                else
                {
                    @if (Model.Hesaplar == null || Model.Hesaplar.Count == 0)
                    {
                        <div class="hero-premium">
                            <div class="hero-premium-content">
                                <span class="badge bg-warning text-dark mb-3 px-3 py-2 rounded-pill fw-bold">
                                    <i class="fas fa-bolt me-1"></i> 3 Dakikada Hesabın Hazır
                                </span>

                                <h1 class="hero-title">
                                    Sıfır Masraf, <br />
                                    Sınırsız Özgürlük.
                                </h1>

                                <p class="hero-desc">
                                    EFT/Havale ücretlerine ve hesap işletim masraflarına veda edin.
                                    EEZ Bank ile paranızı 7/24 ücretsiz yönetin.
                                </p>

                                <div class="d-flex gap-3 flex-wrap">
                                    <a asp-controller="Account" asp-action="HesapOlustur" class="btn btn-light text-primary btn-lg px-5 shadow-sm fw-bold">
                                        Ücretsiz Hesap Aç <i class="fas fa-arrow-right ms-2"></i>
                                    </a>
                                </div>

                                <div class="trust-badges">
                                    <div class="badge-item"><i class="fas fa-check-circle"></i> Ömür Boyu Aidatsız</div>
                                    <div class="badge-item"><i class="fas fa-shield-alt"></i> %100 Güvenli Altyapı</div>
                                    <div class="badge-item"><i class="fas fa-mobile-alt"></i> Tamamen Dijital</div>
                                </div>
                            </div>
                        </div>
                    }
                    else
                    {
                        var anaHesap = Model.Hesaplar.FirstOrDefault();
                        var toplamBakiye = Model.Hesaplar.Sum(x=>x.Balance);
                        var kullaniciAdi = User.Identity.Name;

                        <div class="dashboard-hero">
                            <div class="user-welcome d-flex flex-column justify-content-between">
                                <div class="d-flex flex-wrap align-items-center justify-content-between mb-4">

                                    <div>
                                        <h2 class="fw-bold text-dark-eez m-0">Merhaba, @kullaniciAdi</h2>
                                        <p class="text-secondary mb-1">Finansal durumun harika görünüyor!</p>
                                        <span class="text-muted small">
                                            <i class="far fa-clock me-1"></i> Son giriş: @DateTime.Now.ToString("dd.MM.yyyy HH:mm")
                                        </span>
                                    </div>

                                    <div class="mt-3 mt-md-0">
                                        <div class="d-inline-flex align-items-center bg-white px-4 py-3 rounded-pill shadow-sm border border-light">
                                            <div class="icon-circle bg-light text-success me-3 rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                                <i class="fas fa-wallet"></i>
                                            </div>
                                            <div class="d-flex flex-column text-end">
                                                <span class="text-muted small text-uppercase fw-bold" style="font-size: 0.7rem; letter-spacing: 0.5px;">Toplam Varlık</span>
                                                <span class="fw-black text-dark fs-5 lh-1">
                                                    ₺ @Model.Hesaplar.Sum(x => x.Balance).ToString("N2")
                                                </span>
                                            </div>
                                        </div>
                                    </div>

                                </div>

                                <div class="row">
                                    <div class="col-12">
                                        <div class="d-flex align-items-center justify-content-between mb-3">
                                            <h4 class="fw-bold text-dark-eez m-0">Son İşlemler</h4>
                                            <a asp-controller="Transfer" asp-action="IslemGecmisi" class="btn btn-sm btn-link text-decoration-none">Tümünü Gör</a>
                                        </div>

                                        <div class="recent-table-card border">
                                            <div class="table-responsive">
                                                <table class="table table-hover align-middle mb-0">
                                                    <thead class="bg-light text-muted small text-uppercase">
                                                        <tr>
                                                            <th class="py-3 ps-4">İşlem Türü</th>
                                                            <th class="py-3">Gönderen / Alıcı</th>
                                                            <th class="py-3">Tarih</th>
                                                            <th class="py-3 text-end pe-4">Tutar</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        @if (Model.SonIslemler != null && Model.SonIslemler.Any())
                                                        {
                                                            @foreach (var islem in Model.SonIslemler)
                                                            {
                                                                Model.GonderenMi = Model.Hesaplar.Any(x => x.HesapId == islem.GonderenHesapId);

                                                                var textClass = Model.GonderenMi ? "text-danger" : "text - success";
                                                                var isaret = Model.GonderenMi ? "-" : "+";

                                                                Model.KarsiTarafAdi = "Bilinmiyor";

                                                                if (Model.GonderenMi)
                                                                {
                                                                    Model.KarsiTarafAdi = islem.AliciBankaHesabi?.User?.FullName ?? islem.Aciklama ?? "Ödeme";
                                                                }
                                                                else
                                                                {
                                                                    Model.KarsiTarafAdi = islem.GonderenBankaHesabi?.User?.FullName ?? "Bilinmeyen Gönderici";
                                                                }

                                                                <tr>
                                                                    <td class="ps-4">
                                                                        @if (islem.Tur == EEZBankServer.Models.IslemTuru.EFT || islem.Tur == EEZBankServer.Models.IslemTuru.Havale)
                                                                        {
                                                                            if (Model.GonderenMi)
                                                                            {
                                                                                <span class="status-badge badge-eft text-danger bg-danger bg-opacity-10">
                                                                                    <i class="fas fa-arrow-up me-1"></i> Giden
                                                                                </span>
                                                                            }
                                                                            else
                                                                            {
                                                                                <span class="status-badge badge-eft text-success bg-success bg-opacity-10">
                                                                                    <i class="fas fa-arrow-down me-1"></i> Gelen
                                                                                </span>
                                                                            }
                                                                        }
                                                                        else
                                                                        {
                                                                            <span class="status-badge badge-bill"><i class="fas fa-file-invoice me-1"></i> Fatura</span>
                                                                        }
                                                                    </td>
                                                                    <td>
                                                                        <div class="d-flex flex-column">
                                                                            <span class="fw-bold text-dark">
                                                                                @Model.KarsiTarafAdi
                                                                            </span>
                                                                            <span class="small text-muted">
                                                                                @islem.Aciklama
                                                                            </span>
                                                                        </div>
                                                                    </td>
                                                                    <td class="text-muted small">
                                                                        @islem.IslemTarihi.ToString("dd.MM.yyyy HH:mm")
                                                                    </td>
                                                                    <td class="text-end pe-4">
                                                                        <span class="fw-bold @textClass">
                                                                            @isaret @islem.IslemMiktari.ToString("N2") ₺
                                                                        </span>
                                                                    </td>
                                                                </tr>
                                                            }
                                                        }
                                                        else
                                                        {
                                                            <tr>
                                                                <td colspan="4" class="text-center py-5 text-muted">
                                                                    <i class="fas fa-inbox fa-2x mb-3 d-block opacity-25"></i>
                                                                    Henüz bir transfer veya ödeme işleminiz bulunmuyor.
                                                                </td>
                                                            </tr>
                                                        }
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                }
            </div>
        </div>

        <div class="row section-gap g-4">
            <div class="col-lg-8">
                <div class="row g-4 h-100">
                    <div class="col-md-4">
                        <div class="nav-action-card">
                            <div class="icon-box bg-soft-blue"><i class="fas fa-paper-plane"></i></div>
                            <h5>Hızlı Transfer</h5>
                            <p>IBAN'a veya Kolas Adres'e 7/24 anında para gönderin.</p>
                            <a asp-controller="Transfer" asp-action="index" class="stretched-link"></a>
                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="nav-action-card">
                            <div class="icon-box bg-soft-purple"><i class="fas fa-mobile-alt"></i></div>
                            <h5>Dijital Bankacılık</h5>
                            <p>Fatura ödemeden yatırım işlemlerine kadar her şey cebinizde.</p>
                            <a asp-controller="Account" asp-action="Profile" class="stretched-link"></a>

                        </div>
                    </div>

                    <div class="col-md-4">
                        <div class="nav-action-card">
                            <div class="icon-box bg-soft-orange"><i class="fas fa-user-plus"></i></div>
                            <h5>Hesap Aç</h5>
                            <p>Şubeye gitmeden, birkaç tıkla anında EEZ'li olun.</p>
                            <a asp-controller="Account" asp-action="HesapOlustur" class="stretched-link"></a>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="sticky-widget">
                    @await Component.InvokeAsync("DovizKurlari")
                </div>
            </div>
        </div>

    </div>
</div>